<!DOCTYPE html>
<html>
<head>
    <script src="./phaser.js" type="text/javascript"></script>
</head>
<body>
    <script type="text/javascript">
        var Player = function() {
            this.x = 0;
            this.y = 0;
            this.z = 0;
        };

        var Road = function() {
            this.segments = [];
            for(var i = 0; i < this.segmentsCount; i++) {
                this.segments.push({
                    z : this.segmentGap * i,
                    color : i % 2 ? this.colors.light : this.colors.dark
                });
            }
        };

        Road.prototype = {
            width : 2000,
            segmentCount : 500,
            segmentGap : 200,
            lanes : 3,
            colors : {
                light : {
                    road : '#6B6B6B',
                    grass : '#10AA10',
                    rumble : '#555555',
                    lane : '#CCCCCC'
                },
                dark : {
                    road : '#696969',
                    grass : '#009A00',
                    rumble : '#BBBBBB'
                }
            }
        }

        function Racer(opts) {
            this.fieldOfView = 100;
            this.scale = 1 / Math.tan(this.fieldOfView / 2 / 180 * Math.PI);
            this.player = new Player();
            this.road = new Road();
            this.engine = new Phaser.Game(this.canvasWidth, this.canvasHeight, Phaser.AUTO, "racer");
            this.engine.state.add("racer", this, true);
        }

        Racer.prototype = {
            canvasWidth : 640,

            canvasHeight : 480,

            cameraX : 0,

            cameraY : 2000,

            cameraZ : 0,

            project : function(x, y, z) {
                // this.cameraY / screenY = z / this.scale;
                // x / scrennX = z / this.scale;
                return {
                    screenX : x / z * this.scale,
                    screenY : this.cameraY / z * this.scale
                }
            },

            preload : function() {
                this.engine.load.image("background-hills", "javascript-racer-master/images/background/hills.png");
                this.engine.load.image("background-sky", "javascript-racer-master/images/background/sky.png");
                this.engine.load.image("background-trees", "javascript-racer-master/images/background/trees.png");
                this.engine.load.image("player-left", "javascript-racer-master/images/sprites/player_left.png");
                this.engine.load.image("player-right", "javascript-racer-master/images/sprites/player_right.png");
                this.engine.load.image("player-straight", "javascript-racer-master/images/sprites/player_straight.png");
            },

            create : function() {
                this.engine.add.sprite(0, 0, "background-sky");
                this.engine.add.sprite(0, 0, "background-hills");
                this.engine.add.sprite(0, 0, "background-trees");
            }
        };

        var racer = new Racer();
    </script>
</body>
</html>